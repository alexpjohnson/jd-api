<md-menu
  md-position-mode="target-right target">
  <a
    aria-label="comment" 
    class="md-icon-button" 
    ng-click="$ctrl.openCommentMenu($mdOpenMenu, $event)">
    <md-icon md-menu-origin class="material-icons">comment</md-icon>
  </a>
  <md-menu-content 
    class="comment-menu"
    width="4">
        <md-menu-item>
            <form ng-submit="$ctrl.add()">
              <input 
                md-autofocus
                ng-model="$ctrl.text"
                type="text"
                placeholder="Comment.."
                class="add-comment-input">
            </form>
        </md-menu-item>
      <md-list
        class="md-dense" 
        ng-if="$ctrl.hasComments()">
            <md-subheader
                ng-if="$ctrl.spec.grouped_comments_json.false.length">
                Unresolved</md-subheader>
            <md-list-item 
                md-prevent-menu-close="md-prevent-menu-close"
                ng-click="$ctrl.resolve(comment)" 
                aria-label="resolve"
                ng-repeat="comment in $ctrl.spec.grouped_comments_json.false"
                class="md-2-line md-long-text">
                <md-menu-item>
                <md-icon 
                    ng-if="!comment.user.image"
                    class="no-image material-icons md-avatar">
                    account_circle</md-icon>
                <img 
                    ng-if="comment.user.image"
                    ng-src="{{comment.user.image}}" 
                    class="menu-avatar md-avatar"/>
                <div class="md-list-item-text">
                    <h3 ng-bind="comment.text"></h3>
                    <p>{{comment.user.name}} at {{$ctrl.formatTime(comment)}}</p>
                </div>
                </md-menu-item>
            </md-list-item>
            <md-subheader
                ng-if="$ctrl.spec.grouped_comments_json.true.length">Resolved</md-subheader>
            <md-list-item 
                ng-repeat="comment in $ctrl.spec.grouped_comments_json.true"
                class="md-2-line md-long-text">
                <md-menu-item>
                <md-icon 
                    ng-if="!comment.user.image"
                    class="no-image material icons md-avatar">
                    account_circle</md-icon>
                <img 
                    ng-if="comment.user.image"
                    ng-src="{{comment.user.image}}" 
                    class="menu-avatar md-avatar"/>
                <div class="md-list-item-text">
                    <h3 ng-bind="comment.text"></h3>
                    <p>{{comment.user.name}} at {{$ctrl.formatTime(comment)}}</p>
                </div>
                </md-menu-item>
            </md-list-item>
        </md-list>
        <md-menu-item
            ng-if="!$ctrl.hasComments()">
            <p class="no-comments" flex>
                This spec has no comments.
            </p>
        </md-menu-item>
       
  </md-menu-content>
</md-menu>